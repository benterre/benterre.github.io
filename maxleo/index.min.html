<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="style.css"><link href="prism/prism.css" rel="stylesheet"><title>Max/Leo website</title></head><body><div class="mainpage" style="display:inherit"><h1>The Raspberry pi car!</h1><img src="https://cdn.shopify.com/s/files/1/0176/3274/products/Raspberry-Pi-4-8GB_130x.jpg" alt="raspberryPi"> <img src="rccar.png" alt="rccar" style="width:20%"><h2>1 Seting up a website</h2><p>Why? Well we will use this to control the car remotely! And we'll know how to make super cool websites <a href="https://www.w3schools.com/charsets/ref_emoji.asp">&#128521</a></p><h3>1.1 The basics of HTML</h3><p>We can check the <a href="https://www.w3schools.com/html/html_intro.asp">w3schools' website</a> to have a look at the basics of HTML.<br>Every web browser will receive a .html file which it will read to display the website.<br>Here is how such a file is structured:</p><div class="html-structure-html">&#60html&#62<div class="html-structure-in html-structure-head">&#60head&#62<div class="html-structure-in html-structure-headinnerbox"><div class="html-structure-in html-structure-headcontent">&#60link rel="stylesheet" href="style.css"&#62</div><div class="html-structure-in html-structure-headcontent">&#60title&#62Max/Leo website&#60/title&#62</div></div>&#60/head&#62</div><div class="html-structure-in html-structure-body">&#60body&#62<div class="html-structure-in html-structure-bodyinnerbox"><div class="html-structure-in html-structure-bodycontent">&#60h1&#62The raspberry pi car!&#60/h1&#62</div><div class="html-structure-in html-structure-bodycontent">&#60h2&#62 1 Setting up a website&#60/h2&#62</div><div class="html-structure-in html-structure-bodycontent">&#60p&#62Why? Well we will use this to control the car remotely!&#60/p&#62</div></div>&#60/body&#62</div>&#60/html&#62</div><p>&#60head&#62 contains extra information the browser will use to stylise your website. The stylesheet will be used to change colors, fonts, etc...<br>The title will show up on your browser, usually in the tab.</p><pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
    &lt;head&gt;
        &lt;link rel="stylesheet" href="style.css"&gt;
        &lt;title&gt;Max/Leo website&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;The Raspberry pi car!&lt;/h1&gt;
        &lt;h2&gt;1 Seting up a website&lt;/h2&gt;
        &lt;p&gt;Why? Well we will use this to control the car remotely!&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre><p>The &#60body&#62 is where the real deal is! This is where the website is constructed. I have placed here the first few lines from this website.<br>&#60h1&#62 on the other hand tells the browser this is a title. &#60h2&#62, &#60h3&#62, ... are then subtitles, subsubtitles, etc.<br>&#60p&#62 is a paragraph element.</p><h3>1.2 The basics of CSS</h3><p>This time you can check <a href="https://www.w3schools.com/css/css_intro.asp">this</a> page from w3schools for more info about the topic.<br>CSS can be formated in a different file. In order for your browser to know what file to use in order to stylise your webpage, you must specify its path in the &#60link&#62 element from the previous chapter. In this case, we created a file called style.css and linked it.<br>So... remember those elements from the previous chapter? Well you can give them special names! Those names won't appear on your browser, but will allow the CSS file to know what part of the HTML file to stylise in which way.</p><p>Let us consider an example of turning the pure HTML ouput on the left to the CSS stylised output on the right.</p><div style="width:600px;margin:0 auto"><div style="float:left;height:50px">This is boring text &#128546</div><a href="https://youtu.be/dQw4w9WgXcQ?autoplay=1" class="css-example-1" style="float:right;height:50px">This is much better! &#128526</a></div><p style="clear:both">Both are generated using the same HTML code with the only difference being in the class name. This class name is the string we use to identify this element in the HTML file.</p><pre><code class="language-html">&lt;div class="css-example-1"&gt;
    This is much better! &#128526
&lt;/div&gt;</code></pre><p>In the CSS file we can now write</p><pre><code class="language-css">.css-example-1 {
    border-style: solid;
    border-radius: 15px;
    border-color: red;
    background-image: url("Big_Chungus.png");
    background-size: 150px;
    color: white;
}</code></pre><p>And voilà! This is all we need to change the looks of our HTML.</p><h3>1.3 Make your own website</h3><p>Let's edit this webpage together! We can make it look however we wish!</p><h2>2 Using the pins on the Raspberry Pi</h2><div class="sketchfab-embed-wrapper"><iframe title="Raspberry Pi 4 Model B" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking" xr-spatial-tracking execution-while-out-of-viewport execution-while-not-rendered web-share src="https://sketchfab.com/models/2d4612b0758047eb940d1d52de25bee8/embed?autospin=1&autostart=1&ui_theme=dark"></iframe></div><img src="https://www.etechnophiles.com/wp-content/uploads/2021/01/R-Pi-4-GPIO-Pinout.jpg" alt="Raspberry Pi Pins"><h3>2.1 The basic functions</h3><p>First and foremost, let us import the library required to control the pins</p><pre><code class="language-python">import RPi.GPIO as GPIO</code></pre><p>We can then choose how we want to refer to the different pins. Option number 1, use the physical numbering</p><pre><code class="language-python">GPIO.setmode(GPIO.BOARD)</code></pre><p>Option number 2, we can refer to them by their ordered number (more info <a href="https://pinout.xyz/#">here</a>)</p><pre><code class="language-python">GPIO.setmode(GPIO.BCM)</code></pre><p>We can then configure a specific pin to either input a signal or output a signal using</p><pre><code class="language-python">GPIO.setup(#PinNum, GPIO.OUT)
GPIO.setup(#PinNum, GPIO.IN)</code></pre><p>Sending out a signal can be done by turning the GPIO pin on and then off</p><pre><code class="language-python">GPIO.output(#PinNum, True)
GPIO.output(#PinNum, Flase)</code></pre><p>On the other hand, reading off the state of an input GPIO can be done using</p><pre><code class="language-python">GPIO.input(#PinNum)</code></pre><p>This function will return 1 if the pin is receiving a signal and 0 otherwise.</p><h3>2.2 Using the ultrasonic sensor</h3><div class="sketchfab-embed-wrapper"><iframe title="Sensor Ultrasonik 3D" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" allow="autoplay; fullscreen; xr-spatial-tracking" xr-spatial-tracking execution-while-out-of-viewport execution-while-not-rendered web-share src="https://sketchfab.com/models/73860325145a47e09d473d8e7d2f99d6/embed?autospin=1&autostart=1&camera=0&preload=1&ui_theme=dark"></iframe><p style="font-size:13px;font-weight:400;margin:5px;color:#4a4a4a"><a href="https://sketchfab.com/3d-models/sensor-ultrasonik-3d-73860325145a47e09d473d8e7d2f99d6?utm_medium=embed&utm_campaign=share-popup&utm_content=73860325145a47e09d473d8e7d2f99d6" target="_blank" style="font-weight:700;color:#1caad9">Sensor Ultrasonik 3D </a>by <a href="https://sketchfab.com/fslakbar?utm_medium=embed&utm_campaign=share-popup&utm_content=73860325145a47e09d473d8e7d2f99d6" target="_blank" style="font-weight:700;color:#1caad9">fslakbar </a>on <a href="https://sketchfab.com?utm_medium=embed&utm_campaign=share-popup&utm_content=73860325145a47e09d473d8e7d2f99d6" target="_blank" style="font-weight:700;color:#1caad9">Sketchfab</a></p></div><p>The ultrasonic sensor we are using (ELAGOO HC-SR04) has a certain number of restrictions on its inputs and outputs. These can be found in the products <a href="./pdf/hc-sr04_ultrasonic_module_user_guidejohn .pdf">documentation</a>. One important fact is that the ECHO signal peaks at 5V when the Raspberry Pi only allows 3.3V inputs, at most.</p><p>As described by <a href="https://tutorials-raspberrypi.com/raspberry-pi-ultrasonic-sensor-hc-sr04/">tutorials-raspberrypi.com</a>, we could program the timing manually as follows</p><pre><code class="language-python"># set Trigger to HIGH
GPIO.output(GPIO_TRIGGER, True)

# set Trigger after 0.01ms to LOW
time.sleep(0.00001)
GPIO.output(GPIO_TRIGGER, False)</code></pre>All together, the python script would look like this<pre><code class="language-python">import RPi.GPIO as GPIO
import time
GPIO.setmode(BPIO.BOARD)

TRIG = ##
ECHO = ##

GPIO.setup(TRIG, GPIO.OUT)
GPIO.setup(ECHO, GPIO.IN)

#make sure the sensor has settled down
GPIO.output(TRIG, False)
time.sleep(2)

#Send a 10μs pulse
GPIO.output(TRIG, True)
time.sleep(0.00001)
GPIO.output(TRIG, False)

#Keep track of when the signal was sent (i.e. now)
p_start = time.time()

#Wait for signal to come back and record that time
while True:
    if GPIO.input(ECHO) == 1:
        p_end = time.time()
        break()

p_duration = p_end - p_start

distance = p_duration * #speed of sound in your chosen units

print(round(distance, 2), " units")</code></pre><p>However, there is a simpler way of doing this. Indeed, by using the gpiozero library we can greatly simplify our code.</p><pre><code class="language-python">from signal import signal, SIGTERM, SIGHUP, pause
from time import sleep
from gpiozero import DistanceSensor

sensor = DistanceSensor(echo=27, trigger=4)

def safe_exit(signum, frame):
    exit(1)

def read_distance():
    while True:
        print("Distance: " + "{:1.2f}".format(sensor.value) +  "m")
        sleep(0.1)

signal(SIGTERM, safe_exit)
signal(SIGHUP, safe_exit)

try:
    read_distance()

except KeyboardInterrupt:
    pass

finally:
    sensor.close()</code></pre><p>This particular coding style will allow us to send this distance information to our computer through a webserver while performing other tasks.</p><h2>3 Using the pi camera module</h2><h3>3.1 Installation</h3>First of all, we need to install any dependencies for the camera module. The latest package that allow us to interact with the camera module is <a href="https://www.raspberrypi.com/documentation/accessories/camera.html">libcamera</a>.<br>One can install this package by opening the terminal and typing<pre><code class="language-python">sudo apt install libcamera-apps</code></pre>We can then check that everything is working properly by typing<pre><code class="language-python">libcamera-hello</code></pre><h3>3.2 Saving a picture</h3>One can take a picture simply by typing libcamera-jpeg. However, there are other parameters to play with. Here is an example that contains a few of them<pre><code class="language-python">libcamera-jpeg -o test.jpg -t 2000 --width 640 --height 480 --shutter 20000 --gain 1.5</code></pre>As detailed in <a href="https://www.raspberrypi.com/documentation/accessories/camera.html#libcamera-and-libcamera-apps-packages">the official documentation</a> the various parameters stand for<ul><li><pre>-o                     output file name</pre></li><li><pre>-t                     preview duration</pre></li><li><pre>--width / --height     are self-explanatory</pre></li><li><pre>--shutter              shutter speed (amount of time the camera captures light for) in μs</pre></li><li><pre>--gain                 amount of gain to apply (controls overall brightness)</pre></li></ul><h3>3.3 Saving a video</h3>To capture videos, we can simply write<pre><code class="language-python">libcamera-vid -t 10000 -o test.h264</code></pre>This file type is rather uncommon but we can convert it to a more familiar format by the combination of commands<pre><code class="language-python">libcamera-vid -o test.h264 --save-pts timestamps.txt
mkvmerge -o test.mkv --timecodes 0:timestamps.txt test.h264</code></pre><h3>3.4 Streaming a video</h3>Finally, to get back to what we are actually interested in, we can stream video directly from the raspberry pi.<br>As described in <a href="https://www.raspberrypi.com/documentation/accessories/camera.html#libcamera-and-libcamera-apps-packages">the official documentation</a> we can choose three different kinds of video streams: UDP, TCP or RTSP.<br>Our stream of interest will be a TCP stream as it allows for fast and reliable transmissions. To do this, for developement purposes, we can enter the command<pre><code class="language-python">libcamera-vid -t 0 --inline --listen -o tcp://0.0.0.0:3000</code></pre>In order to receive this stream, we can enter the following command on our laptop (requires ffmpeg to be installed)<pre><code class="language-python">ffplay tcp://raspberrypi.local:3000 -vf "setpts=N/30" -fflags nobuffer -flags low_delay -framedrop</code></pre><h2>4 Sending data back to our computer</h2><p>In order for us to control the car we must figure out a way of sending data back and forth between our computer and the raspberry pi without needing to login in wit ssh.<br>One way of achieving this is by using a websocket server. This server continuously listens for clients and establishes a bidirectional connection when the appear. I have already set up such a server at the address www.benterre.com<br>We can then create both a webpage that will connect to this server on the client side and a python script on the raspberry pi.</p><h3>4.1 The webpage</h3><p>To save us some time, I have already created a webpage template at <a href="./car">www.benterre.com/maxleo/car</a>.<br>This template comes equipped with a javascript file which we will edit.<br>To connect to a websocket server we must add the following line of code a the start of the file</p><pre><code class="language-js">const socket = io("https://www.benterre.com", {reconnection: true});</code></pre><p>We can then send information between the server and the client using the emit command</p><pre><code class="language-js">socket.emit("maxleocar", message);</code></pre><p>And receive information using the on command</p><pre><code class="language-js">socket.on("maxleocar", message => {
    //do something
});</code></pre><p>You can download the required files by clicking those links</p><ul><li><a href="./car/index.html" download>index.html</a></li><li><a href="./car/main.js" download>main.js</a></li></ul><p></p><h3>4.2 The raspberrypi</h3><p>The python script can be written in a very similar fashion to the webpage. We must first install some dependencies, however.<br>We wish to install a package that can handle websocket connections and messages. For this purpose, we will use the package python-socketio.<br>As described in the <a href="https://python-socketio.readthedocs.io/en/latest/client.html">official documentation</a>, this can be installed using the pip command</p><pre><code class="language-python">pip install "python-socketio[client]"</code></pre><p>We can then import the library and initialise the client using</p><pre><code class="language-python">import socketio

sio = socketio.Client()</code></pre><p>Connecting to our server is simply done with</p><pre><code class="language-python">sio.connect('https://www.benterre.com')</code></pre><p>Message can be received using</p><pre><code class="language-python">@sio.on('maxleocar')
def on_message(data):
    #do something</code></pre><p>and sent with</p><pre><code class="language-python">sio.emit('maxleocar', message)</code></pre></div><div class="mainpage"><h1>Flappy Bird AI!</h1><img src="flappy/flappy.png" alt="flappy" style="width:30%"> <img src="flappy/flappy2.png" alt="flappy" style="width:30%"><p>Before we can program a self driving car, we will need some practice with AI and neural networks.<br>With that in mind, let us program an AI that learns how to play flappy bird!<br>The full tutorial can be found <a href="https://www.youtube.com/watch?v=ps55secj7iU">here</a>.</p><h2>1 Downloading the required files</h2><p>Go ahead and download the requied files from the links below.</p><ul><li><a href="flappy/base.png">base.png</a></li><li><a href="flappy/bg.png">bg.png</a></li><li><a href="flappy/bird1.png">bird1.png</a></li><li><a href="flappy/bird2.png">bird2.png</a></li><li><a href="flappy/bird3.png">bird3.png</a></li><li><a href="flappy/pipe.png">pipe.png</a></li></ul><h2>2 Next up, we can start coding the game!</h2><pre><code class="language-python">#https://www.youtube.com/watch?v=ps55secj7iU

import pygame
import time
import random

pygame.font.init()

WIN_WIDTH = 500
WIN_HEIGHT = 800

BIRD_IMGS = [pygame.transform.scale2x(pygame.image.load("flappyBirdAI/imgs/bird1.png")), pygame.transform.scale2x(pygame.image.load("flappyBirdAI/imgs/bird2.png")), pygame.transform.scale2x(pygame.image.load("flappyBirdAI/imgs/bird3.png"))]
PIPE_IMG = pygame.transform.scale2x(pygame.image.load("flappyBirdAI/imgs/pipe.png"))
BASE_IMG = pygame.transform.scale2x(pygame.image.load("flappyBirdAI/imgs/base.png"))
BG_IMG = pygame.transform.scale2x(pygame.image.load("flappyBirdAI/imgs/bg.png"))

STAT_FONT = pygame.font.SysFont("comicsans", 50)

class Bird:
    IMGS = BIRD_IMGS
    MAX_ROTATION = 25
    ROT_VEL = 20
    ANIMATION_TIME = 5

    def __init__(self, x, y):
        self.x = x
        self.y = y
        self.tilt = 0
        self.tick_count = 0
        self.vel = 0
        self.height = self.y
        self.img_count = 0
        self.img = self.IMGS[0]
    
    def jump(self):
        self.vel = -10.5 
        self.tick_count = 0
        self.height = self.y
    
    def move(self):
        self.tick_count += 1
        d = self.vel*self.tick_count + 1.5*self.tick_count**2

        if d >= 16:
            d = 16
        elif d &#60 0:
            d -= 2
        
        self.y = self.y + d

        if d &#60 0 or self.y &#60 self.height + 50:
            if self.tilt &#60 self.MAX_ROTATION:
                self.tilt = self.MAX_ROTATION
        else:
            if self.tilt > -90:
                self.tilt -= self.ROT_VEL
    
    def draw(self, win):
        self.img_count += 1

        if self.img_count &#60 self.ANIMATION_TIME:
            self.img = self.IMGS[0]
        elif self.img_count &#60 self.ANIMATION_TIME*2:
            self.img = self.IMGS[1]
        elif self.img_count &#60 self.ANIMATION_TIME*3:
            self.img = self.IMGS[2]
        elif self.img_count &#60 self.ANIMATION_TIME*4:
            self.img = self.IMGS[1]
        elif self.img_count == self.ANIMATION_TIME*4+1:
            self.img = self.IMGS[0]
            self.img_count = 0
        
        if self.tick_count &#60= -80:
            self.img = self.IMGS[1]
            self.img_count = self.ANIMATION_TIME*2
        
        rotated_image = pygame.transform.rotate(self.img, self.tilt)
        new_rect = rotated_image.get_rect(center=self.img.get_rect(topleft=(self.x,self.y)).center)
        win.blit(rotated_image, new_rect.topleft)
    
    def get_mask(self):
        return pygame.mask.from_surface(self.img)


class Pipe:
    GAP = 200
    VEL = 5

    def __init__(self,x):
        self.x = x
        self.height = 0

        self.top = 0
        self.bottom = 0
        self.PIPE_TOP = pygame.transform.flip(PIPE_IMG, False, True)
        self.PIPE_BOTTOM = PIPE_IMG

        self.passed = False
        self.set_height()
    
    def set_height(self):
        self.height = random.randrange(50,450)
        self.top = self.height - self.PIPE_TOP.get_height()
        self.bottom = self.height + self.GAP
    
    def move(self):
        self.x -= self.VEL
    
    def draw(self, win):
        win.blit(self.PIPE_TOP, (self.x, self.top))
        win.blit(self.PIPE_BOTTOM, (self.x, self.bottom))
    
    def collide(self, bird):
        bird_mask = bird.get_mask()
        top_mask = pygame.mask.from_surface(self.PIPE_TOP)
        bottom_mask = pygame.mask.from_surface(self.PIPE_BOTTOM)

        top_offset = (self.x - bird.x, self.top - round(bird.y))
        bottom_offset = (self.x - bird.x, self.bottom - round(bird.y))

        b_point = bird_mask.overlap(bottom_mask, bottom_offset)
        t_point = bird_mask.overlap(top_mask, top_offset)

        if t_point or b_point:
            return True

        return False

class Base:
    VEL = 5
    WIDTH = BASE_IMG.get_width()
    IMG = BASE_IMG

    def __init__(self, y):
        self.y = y
        self.x1 = 0
        self.x2 = self.WIDTH
    
    def move(self):
        self.x1 -= self.VEL
        self.x2 -= self.VEL

        if self.x1 + self.WIDTH &#60 0:
            self.x1 = self.x2 + self.WIDTH
        
        if self.x2 + self.WIDTH &#60 0:
            self.x2 = self.x1 + self.WIDTH
    
    def draw(self, win):
        win.blit(self.IMG, (self.x1, self.y))
        win.blit(self.IMG, (self.x2, self.y))

def draw_window(win, bird, pipes, base, score):
    win.blit(BG_IMG, (0,0))
    for pipe in pipes:
        pipe.draw(win)
    
    text = STAT_FONT.render("Score: " + str(score), 1, (255,255,255))
    win.blit(text, (WIN_WIDTH-10-text.get_width(), 10))
    
    base.draw(win)

    bird.draw(win)
    pygame.display.update()

def main():
    bird = Bird(230, 0)
    base = Base(730)
    pipes = [Pipe(600)]
    win = pygame.display.set_mode((WIN_WIDTH, WIN_HEIGHT))
    clock = pygame.time.Clock()
    
    score = 0

    run = True
    while run:
        clock.tick(30)
        for event in pygame.event.get():
            if event.type == pygame.QUIT:
                run = False
            if event.type == pygame.KEYDOWN:
                if event.key == pygame.K_SPACE:
                    bird.jump()
        bird.move()
        add_pipe = False
        rem = []
        for pipe in pipes:
            if pipe.collide(bird):
                run = False
            if pipe.x + pipe.PIPE_TOP.get_width() &#60 0:
                rem.append(pipe)
            if not pipe.passed and pipe.x &#60 bird.x:
                pipe.passed = True
                add_pipe = True
            pipe.move()

        if add_pipe:
            score += 1
            pipes.append(Pipe(600))
        
        for r in rem:
            pipes.remove(r)
        
        if bird.y + bird.img.get_height() >= 730: 
            run = False
            
        base.move()
        draw_window(win, bird, pipes, base, score)


    pygame.quit()
    quit()

main()</code></pre></div><script src="prism/prism.js"></script><script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script><script nomodule src="https://unpkg.com/@google/model-viewer/dist/model-viewer-legacy.js"></script></body></html>